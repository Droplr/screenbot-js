/*! screenbot v0.1.0 - 2016-04-14 
 *  License: Apache-2.0 */

var Screenbot=function(){function a(a){return function(b){this.command(a,b)}}function b(a){var b;try{if(b=JSON.parse(a),!b.ok)return new d(f,b)}catch(c){return new d(h)}return b}function c(a,c){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var a=b(e.responseText);a instanceof Error&&c(a),c(null,a)}else if(4===e.readyState&&""===e.responseText)return c(new d(g))},e.open("GET",a,!0),e.send()}function d(a,b){Error.call(this),this.name="Screenbot Error",this.code=a.code,this.message=a.message||"An error has occurred",this.originalException=b}function e(a,b){"undefined"==typeof b&&(b={}),this.source=null,this.token=a||null,this.service=b.service||"sdk",this.host=b.host||"https://app.screenbot.io"}var f={code:1,message:"Screenbot isn't running"},g={code:2,message:"No data received"},h={code:3,message:"Error parsing response"},i=["ping",["activate",""],"shot","draw","cast","clip"];return d.prototype=Object.create(Error.prototype),d.prototype.constructor=d,e.prototype._endpoint=function(a){return this.host+"/api/services/"+this.service+"/command?token="+this.token+"&text="+a},e.prototype._response_endpoint=function(a){return this.host+"/api/services/"+this.service+"/response?channel_token="+a},e.prototype._setEventSourceTimer=function(){return setTimeout(function(){this.source.close()}.bind(this),2e3)},e.prototype.command=function(a,b){console.log("Source: "+this.source),c(this._endpoint(a),function(a,c){if(a)return b(a);if("connected"in c)return b(null,{connected:c.connected});this.source&&2!==this.source.readyState&&this.source.close(),this.source=new EventSource(this._response_endpoint(c.token));var e=this._setEventSourceTimer();this.source.onmessage=function(a){if(clearTimeout(e),this.source.close(),"0"===a.data||!a.data.length)return b(new d(g));var c={url:a.data};b(null,c)}.bind(this)}.bind(this))},i.forEach(function(b){b instanceof Array?e.prototype[b[0]]=a(b[1]):e.prototype[b]=a([b])}),e}();
//# sourceMappingURL=screenbot-v0.1.0.min.js.map